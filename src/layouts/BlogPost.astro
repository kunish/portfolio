---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import type { Lang } from '../i18n/ui';
import { useTranslations, useTranslatedPath } from '../i18n/utils';

type Props = CollectionEntry<'blog'>['data'] & {
  lang?: Lang;
  slug?: string;
};

const { title, description, pubDate, updatedDate, lang = 'zh', slug } = Astro.props;
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const ogImage = slug ? `/og/${slug}.png` : undefined;
---

<!doctype html>
<html lang={lang === 'zh' ? 'zh-CN' : 'en'}>
  <head>
    <BaseHead title={`${title} - ${t('site.title')}`} description={description} ogImage={ogImage} article={true} publishedTime={pubDate} />
  </head>

  <body>
    <Header />

    <main class="pt-20">
      <section class="py-16 md:py-24 gradient-mesh noise-overlay">
        <div class="container-swiss relative z-10">
          <div class="max-w-4xl">
            <div class="flex items-center gap-4 text-text-muted text-sm uppercase tracking-[0.12em] mb-6 hero-animate-title">
              <FormattedDate date={pubDate} lang={lang} />
              {updatedDate && (
                <span class="flex items-center gap-2">
                  <span class="w-1 h-1 bg-text-muted rounded-full"></span>
                  <span>
                    {lang === 'zh' ? '更新于' : 'Updated'} <FormattedDate date={updatedDate} lang={lang} />
                  </span>
                </span>
              )}
            </div>

            <h1 class="text-4xl md:text-5xl lg:text-6xl font-display tracking-tight leading-[1.1] hero-animate-subtitle">
              {title}
            </h1>

            {description && (
              <p class="mt-6 text-xl text-text-secondary leading-relaxed hero-animate-cta">
                {description}
              </p>
            )}
          </div>
        </div>
      </section>

      {ogImage && (
        <section class="pb-16 animate-on-scroll" data-animation="scaleIn">
          <div class="container-swiss">
            <div class="aspect-[1200/630] bg-black overflow-hidden" style="box-shadow: var(--shadow-xl);">
              <img
                width={1200}
                height={630}
                src={ogImage}
                alt={title}
                class="w-full h-full object-cover"
                loading="eager"
              />
            </div>
          </div>
        </section>
      )}

      <section class="pb-24 md:pb-32">
        <div class="container-swiss">
          <article class="max-w-3xl mx-auto prose-swiss">
            <slot />
          </article>
        </div>
      </section>

      <section class="pb-24">
        <div class="container-swiss">
          <div class="max-w-3xl mx-auto">
            <div class="divider pt-12"></div>
            <a
              href={translatePath('/blog')}
              class="inline-flex items-center gap-3 mt-8 text-text-secondary hover:text-accent transition-colors duration-300 font-medium group"
            >
              <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
              </svg>
              <span>{lang === 'zh' ? '返回博客列表' : 'Back to Blog'}</span>
            </a>
          </div>
        </div>
      </section>
    </main>

    <Footer />

    <script>
      const observerOptions = {
        root: null,
        rootMargin: '0px 0px -60px 0px',
        threshold: 0.1
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      document.querySelectorAll('.animate-on-scroll').forEach((el) => {
        observer.observe(el);
      });
    </script>
  </body>
</html>
